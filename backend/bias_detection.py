import logging
from tensorflow import keras
import numpy as np
import tensorflow as tf

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Recreate the TextVectorization layer
max_tokens = 15000
sequence_length = 300

text_vectorization = keras.layers.TextVectorization(
    max_tokens=max_tokens,
    output_sequence_length=sequence_length,
    output_mode='int'
)


# Load your model and weights
def create_multi_output_model(vocab_size, embed_dim=128, num_bias_classes=3, num_opinion_classes=4, num_type_classes=3):
    text_input = keras.layers.Input(shape=(1,), dtype=tf.string)
    vectorized = text_vectorization(text_input)
    embedded = keras.layers.Embedding(vocab_size, embed_dim, mask_zero=True)(vectorized)
    x = keras.layers.Bidirectional(keras.layers.LSTM(64, return_sequences=True))(embedded)
    x = keras.layers.Bidirectional(keras.layers.LSTM(32))(x)
    x = keras.layers.Dense(64, activation="relu")(x)
    x = keras.layers.Dropout(0.5)(x)

    bias_output = keras.layers.Dense(num_bias_classes, activation='softmax', name='bias_output')(x)
    opinion_output = keras.layers.Dense(num_opinion_classes, activation='softmax', name='opinion_output')(x)
    type_output = keras.layers.Dense(num_type_classes, activation='softmax', name='type_output')(x)

    model = keras.Model(text_input, [bias_output, opinion_output, type_output])
    return model

vocab_size = max_tokens + 1  # +1 for the OOV token
bias_model = create_multi_output_model(vocab_size)

# Load weights
try:
    bias_model.load_weights('bias_detection.keras')
    print("Weights loaded successfully.")
except Exception as e:
    print(f"Error loading weights: {e}")

sample_dataset = tf.data.Dataset.from_tensor_slices(
   ["""Speaking to the country for the first time from the Oval Office Tuesday night, President Donald Trump doubled down on his demands for a border wall in a brief speech amid his self-induced government shutdown...""",
   
    """The left has a thing for taking babies hostage. A perfect example of the “give us socialism or we’ll kill the kids” genre was recently published in The Guardian titled “The hardest decision of my life: to end a pregnancy because I had no paid leave.” This sort of story is irresistible to left-wing Christians such as Elizabeth Bruenig of The New York Times, whose tweet about the article is now deleted. It allows them to declare that the real way to end abortion is to make abortion unnecessary, and the only way to do that is by establishing a generous cradle-to-grave welfare state. This argument salves their consciences for their support of radically pro-abortion politicians like Sen. Bernie Sanders. It is also an extension of the dishonest taunt that conservative Christians only care about babies before they’re born. The Guardian article was designed to illustrate that argument, but on examination it demonstrates its failure. The author knew the child in her womb was a unique human life (“Looking at our wedding photos, I realized there were not just two lives present but three”), yet she chose an abortion anyway. Her ostensible reason is that, having just begun her job, she was not yet eligible for its paid leave policy, although management might have made an exception if she had asked (she thought about asking, but didn’t). She would certainly have been able to use sick days, if she had them, or ask for an unpaid leave of absence. This means she aborted her child because she was at risk of losing a few weeks’ pay. The author does not provide details, but it is revealing that she described her decision in terms of anxiety and planning preferences—“Was having the baby with extremely limited funds, in a small apartment, actually a romantic way to start a family?”—rather than directly stating that having the baby would be financially ruinous. She concludes her self-justification by declaring that “our situation did not embody the climate of confidence we agreed was necessary for us to be parents.” This shift from paid leave to a general “climate of confidence” gives the game away. If this was just about a few weeks of pay, it raises the question of whether there was some way for the author to raise that money in lieu of having her child killed. Notably, she does not report asking anyone for help. Her initial framing forces her to put a dollar amount on the life of her child, and confronts whether she could have done anything to ransom her baby. In contrast, demanding a “climate of confidence” makes her subjective sense of things a justification for what she did, regardless of the actual details of her case. This is not to say that her situation was not sympathetic. Having a baby is hard. Caring for a baby is hard. Going back to work after a few weeks, or even a few months, of leave is hard, made harder still if that leave has been at least partly unpaid. But a few weeks of salary is not worth killing your baby for. I am open to arguments that the United States should have more substantial pro-natalist policies, and conservatives have been promoting and debating various proposals that would add to existing policies such as the child tax credit and, yes, paid family leave, which President Trump promoted in his latest State of the Union address. But the left wants more than generous family leave policies, and will still champion abortion even if it gets its entire wish list. Looking around the world, there is never enough socialism for socialists to agree to abolish abortion. Looking around the United States, there is never enough welfare for the left to agree to end abortion—solidly Democratic states lead the nation in abortion rates. Even if the left gets everything else it wants, it will still insist on a right to kill developing humans in utero. In contrast, I and many others would happily compromise to end the legal killing of developing human persons in utero. Tax us more, cut the military, regulate businesses more, and expand the welfare state—we could tolerate America becoming more like 1970s Scandinavia if it meant that the left would agree let the babies live. But the left won’t, and the Guardian article shows why. Bearing and raising children requires sacrifices even in the most generous of welfare states. Rather than make those sacrifices, this mother sacrificed her child, and the left will defend her absolute right to do so even in their socialist utopia. Their vision of liberation from material necessity includes liberation not only from poverty, but also from the consequences of our sexual embodiment. Hence the unwavering socialist support for unrestricted legal abortion. Of course, many people refuse to admit the monstrous reality of the abortion regime that they and their political leaders support. Hence the pretense that some invisible hand of socialist plenty will end abortion, and the efforts to deflect blame for our nation’s abortion culture onto those who are working to abolish it. But it is just not so. It was not stingy family leave policies that had this baby killed, it was the child’s mother, encouraged and enabled by a culture and legal regime that regard babies as a capstone consumer commodity to be ordered up when convenient, and violently disposed of when inconvenient. She didn’t get an abortion because it was impossible for her to afford her baby; she got an abortion because she didn’t want her baby.""",
    
    """Republicans should stop fighting amnesty, President Obama said on Thursday, because one day a Hispanic will become president. “Over the long term, this is going to get solved, because at some point there’s going to be a President Rodriguez or there’s going to be a President Chen,” Obama told a Florida International University town hall audience, hosted by Telemundo and MSNBC. “The country is a nation of immigrants, and ultimately it will reflect who we are and its politics are going to reflect who we are,” Obama continued, implying that neither native-born Americans or legal immigrants have moral standing to determine who enters and stays in the country. Hispanic foreigners attending the town hall — Fox News Latino did not say whether they were legal or illegal aliens — told Obama they feared that federal Judge Andrew Hansen’s stay on Obama’s executive order will force them to return to their home countries. (Fox News Latino incorrectly identifies Hansen as a Texas judge.) The five million illegal aliens covered by Obama’s executive order could also cash in on as much as $35,000 in taxpayer handouts. That’s a minimum $175 million cost to American taxpayers for the first year alone, not counting the massive strain the low-income, poorly-educated, gang-prone aliens with high rates of illegitimacy and untreated diseases will place on the country’s medical and social institutions. Obama’s claim that “history” was on his side is arguably false. The massive, historically unprecedented wave of immigrants crashing across the U.S. southern border is a political phenomenon, set in motion by the 1965 Immigration and Nationality Act and accelerated by the Obama administration’s disastrous Deferred Action for Childhood Arrivals (DACA). The explosion of the Hispanic population has long-term job prospect consequences as well: Both legal and illegal aliens will occupy 75 percent of new American jobs in as little as five years. Each year, four million Americans seeking jobs turn 18. In 2012, almost six million Americans graduated from college, saddled with an average $27,000 in student loan debt — $8,000 less than the handouts available for illegals presently in the country. Email Katie at kmchugh@breitbart.com.""",
        """From soccer games to marathons, concerns about coronavirus have led sports organizers to cancel or modify major events across the globe. With more than 80,000 reported cases of the disease, the viral outbreak continues to create uncertainty about future competitions, from track and field and Formula 1 to the ultimate global event, the 2020 Tokyo Olympics.
Last Sunday’s Tokyo Marathon, usually one of the largest in the world, went ahead with just 200 elite athletes and a request from organizers for spectators to stay home. The Hong Kong Marathon, scheduled for Feb. 9, was canceled; and the World Indoor Track and Field Championships, set for March 13-15 in Nanjing, China, have been postponed until next year.
Let our news meet your inbox. The news and stories that matters, delivered weekday mornings. This site is protected by recaptcha.
For professional athletes whose bodies are their businesses, health is a top priority. As the epidemic spreads, more and more athletes are forced to weigh a potential threat against the financial loss of missing a competition.
“You’re going to get a lot of different answers,” said Chris Layne, managing director of Total Sports US, which represents some of the world’s top track and field athletes. “If you have an athlete at the pinnacle of their career, both in earnings and performance, maybe they can afford to miss an event versus someone fighting to get to that point.”
Track and field athletes don’t typically earn the lucrative salaries seen in the NBA, NFL, tennis or international soccer. The biggest shot for these athletes to make money lies in prizes and sponsorship deals. To earn either, you have to participate in events. That makes the impact of a missed event more significant, according to Layne.
“If you do six events and say you earn $500, that $3,000 lets you keep performing,” he said. “Track and field is really a global sport in terms of events so it could snowball with an athlete losing six, seven, eight times to compete and make a name for themselves. You could be taking away a season’s worth of earning potential.”
One of the bigger sponsorship opportunities for track and field athletes lies in the Olympics, which provide nearly unparalleled exposure. But if coronavirus continues to be a threat, the decision about whether to risk competing could be out of athletes’ hands.
Dick Pound, a senior member of the International Olympic Committee, said a decision about whether to proceed with holding the event would need to be made by late May. If the coronavirus isn’t contained by that point, Pound said cancellation could be a possibility.
For now, the IOC isn’t planning to cancel the Games, which have dealt with potential health threats in the recent past. There were concerns about bird flu ahead of the 2018 Pyeongchang Olympics, Zika during the 2016 Rio Olympics, and swine flu before the 2010 Vancouver Olympics.""",
    
    """More in-person voting sites in metro areas. Better information about where polls have been relocated. More public education about how to vote from home and what to do if an absentee ballot doesn’t arrive—or arrives at the last minute. And no last-minute government decisions that confuse voters and undermine voting, such as imposing curfews before the polls close.
These are some of the takeaways from the nine presidential primaries that took place on June 2, the largest day of voting across America since the pandemic broke in mid-March, where most of the states and the District of Columbia responded by shifting to voting with mailed-out ballots rather than voting centered on local polling places as in previous elections.
The approaches taken in these states and districts varied and reflected the trends seen across the United States. Montana and Maryland mailed ballots to voters. Washington, D.C., and four states sent voters applications to get a mail-in ballot. Pennsylvania and Indiana left it up to voters to apply for an absentee ballot, get the ballots on time, and submit it on time to be counted.
The results were a spectrum of well-run to more-problematic elections. Montana, which is used to voting by mail, had higher turnout than its 2018 fall midterm. But many voters who were not used to voting from home, especially in metro areas, did not get ballots as expected. They went to vote in person, but often found traditional polling places closed. They ended up in long lines and sometimes faced hours-long waits, where social distancing could be challenging, and, in the worst case—in Washington—police were telling voters to go home because of a curfew.
These trends, both better and worse, offer lessons and warning signs for the fall’s elections.
“Overall, this is a dry run for November,” said Kristen Clarke, president and executive director of the Lawyers’ Committee for Civil Rights Under Law, which runs the nation’s largest Election Day hotline and fielded more than 5,000 calls for the primaries. “We’re bracing for high turnout that we will see in the November general election, and lessons learned from this primary season must guide states… to ensure that every eligible voter can have their voice heard.”
“It is clear that the pandemic is having an impact on virtually every aspect of the voting experience,” she said, noting that impact was apart from a curfew in Washington that was announced by a text alert on Election Day that “did not have an exception making it clear that voters can, indeed, continue to travel to cast their ballot.”
Voting in quasi-militarized settings was not confined to the nation’s capital. In Philadelphia, on election eve, the mayor announced a curfew that was slated to take effect an hour before its polls closed, but subsequently delayed it after an outcry by other city officials and activists. The curfews, which have never before occurred on an Election Day in recent times, were a response to looting that occurred after generally peaceful protests against police violence and racism. However, the curfews also come in a climate where the Republican Party, led by President Trump, has been repeatedly making false claims that voting by mail is rife with fraud.
“This is simply not true,” wrote the National Vote at Home Institute’s Amber McReynolds and MIT’s Charles Stewart III, both experts, for the Hill. They noted that the right-wing Heritage Foundation’s oft-cited election fraud database listed 204 cases and 143 convictions using mailed ballots in the past 20 years, where “about 250 million votes have been cast by a mail ballot.” That activity level is “about five times less likely than getting hit by lightning in the United States.”
But while partisan propaganda about voting by mail is only likely to increase as the general election nears, the nuts-and-bolts challenges of shifting to voting by mail in states that have not widely instituted that process is very much a work in progress. In that sense, the statewide and district primaries on June 2, as well as dozens of elections that will be held now through the summer, are microcosms of what is working and what needs to be fixed for the fall.
A Spectrum of States
The June 2 primaries featured jurisdictions with more and less experience running mail-based elections. On the most experienced side, Montana, where the senior statewide election official is a Republican, continued its practice of mailing all voters a ballot. More people voted for its 2020 primary than during the state’s November 2018 midterms.
“Sixty-three percent of active registered voters,” said Phil Keisling, the National Vote at Home Institute’s board chair and former Oregon secretary of state. “That’s higher than 41 states in their midterms in 2018. That’s the power of mailing everyone a ballot.”
While Montana was an example of how voter turnout will increase in states where voters have become used to voting from home, the experience in Midwestern and Eastern states that have not embraced voting from home until the pandemic was rockier was a different story—and not just because of the pandemic’s social distancing requirements or police presence due to widespread protests.
In Pennsylvania’s largest cities, Philadelphia and Pittsburgh, in Washington, D.C., in Baltimore, Maryland, and in Indianapolis, Indiana, election officials underestimated the number of people who sought to vote in person for any number of reasons: from not getting a mail-in ballot; to getting a ballot late and wanting to drop it off; to simply wanting to vote in a polling place.
While Pennsylvania’s top officials reported a “smooth election amid historic circumstances” as 1.8 million residents applied for an absentee ballot, “17 times greater than the number who applied” in its 2016 presidential primary, voting rights advocates manning election-protection hotlines observed a different experience. The Lawyers’ Committee said that 55 percent of the calls received on June 2 were from Pennsylvania—and from people unable to vote by mail.
Half of the hotline calls concerned finding a polling place, the Committee’s Lacy Crawford said. Another 17 percent concerned ballots—meaning unfamiliarity with mailed-out ballots versus polling place voting. Another 13 percent concerned voter registration. Of slightly less than half of the callers who reported their race, 63 percent were Black, 21 percent were white and 12 percent were Latino.
The takeaway from the committee briefings, where its partners summarized what they were hearing from hundreds of observers, underscored that accommodating the fall’s voters will mean planning for high levels of voting from home—but still significant in-person voting at precincts. That conclusion is what emerges after hearing detailed reports of snafus.
“The big theme of the day is confusion,” said Ivan Garcia, civic engagement director for MakeTheRoadPA.org. “Voters are turning up to their old polling place and not always finding directions to the consolidated poll place that they should be going to. Because of the pandemic, you had last-minute changes, and it confused a lot of voters.”"""                                                  
                                                     ]) 
text_vectorization.adapt(sample_dataset)

def predict_article(text: str):
    sample_tensor = tf.constant([text])  # Wrap text in a list to match input shape
    predictions = bias_model.predict(sample_tensor)

    # Get the predicted class indices
    predicted_bias_class = np.argmax(predictions[0], axis=-1)  # Bias predictions
    predicted_opinion_class = np.argmax(predictions[1], axis=-1)  # Opinion predictions
    predicted_type_class = np.argmax(predictions[2], axis=-1)  # Type predictions

    return predicted_bias_class[0], predicted_opinion_class[0], predicted_type_class[0]  # Return class indices
