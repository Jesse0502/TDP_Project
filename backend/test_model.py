import tensorflow as tf
from tensorflow import keras

# Recreate the TextVectorization layer
max_tokens = 15000
sequence_length = 300

text_vectorization = keras.layers.TextVectorization(
    max_tokens=max_tokens,
    output_sequence_length=sequence_length,
    output_mode='int'
)

# Sample article column extracted from your dataset
articles = [
    """Speaking to the country for the first time from the Oval Office Tuesday night, President Donald Trump doubled down on his demands for a border wall in a brief speech amid his self-induced government shutdown...""",
    
    """The left has a thing for taking babies hostage. A perfect example of the “give us socialism or we’ll kill the kids” genre was recently published in The Guardian titled “The hardest decision of my life: to end a pregnancy because I had no paid leave.” This sort of story is irresistible to left-wing Christians such as Elizabeth Bruenig of The New York Times, whose tweet about the article is now deleted. It allows them to declare that the real way to end abortion is to make abortion unnecessary, and the only way to do that is by establishing a generous cradle-to-grave welfare state. This argument salves their consciences for their support of radically pro-abortion politicians like Sen. Bernie Sanders. It is also an extension of the dishonest taunt that conservative Christians only care about babies before they’re born. The Guardian article was designed to illustrate that argument, but on examination it demonstrates its failure. The author knew the child in her womb was a unique human life (“Looking at our wedding photos, I realized there were not just two lives present but three”), yet she chose an abortion anyway. Her ostensible reason is that, having just begun her job, she was not yet eligible for its paid leave policy, although management might have made an exception if she had asked (she thought about asking, but didn’t). She would certainly have been able to use sick days, if she had them, or ask for an unpaid leave of absence. This means she aborted her child because she was at risk of losing a few weeks’ pay. The author does not provide details, but it is revealing that she described her decision in terms of anxiety and planning preferences—“Was having the baby with extremely limited funds, in a small apartment, actually a romantic way to start a family?”—rather than directly stating that having the baby would be financially ruinous. She concludes her self-justification by declaring that “our situation did not embody the climate of confidence we agreed was necessary for us to be parents.” This shift from paid leave to a general “climate of confidence” gives the game away. If this was just about a few weeks of pay, it raises the question of whether there was some way for the author to raise that money in lieu of having her child killed. Notably, she does not report asking anyone for help. Her initial framing forces her to put a dollar amount on the life of her child, and confronts whether she could have done anything to ransom her baby. In contrast, demanding a “climate of confidence” makes her subjective sense of things a justification for what she did, regardless of the actual details of her case. This is not to say that her situation was not sympathetic. Having a baby is hard. Caring for a baby is hard. Going back to work after a few weeks, or even a few months, of leave is hard, made harder still if that leave has been at least partly unpaid. But a few weeks of salary is not worth killing your baby for. I am open to arguments that the United States should have more substantial pro-natalist policies, and conservatives have been promoting and debating various proposals that would add to existing policies such as the child tax credit and, yes, paid family leave, which President Trump promoted in his latest State of the Union address. But the left wants more than generous family leave policies, and will still champion abortion even if it gets its entire wish list. Looking around the world, there is never enough socialism for socialists to agree to abolish abortion. Looking around the United States, there is never enough welfare for the left to agree to end abortion—solidly Democratic states lead the nation in abortion rates. Even if the left gets everything else it wants, it will still insist on a right to kill developing humans in utero. In contrast, I and many others would happily compromise to end the legal killing of developing human persons in utero. Tax us more, cut the military, regulate businesses more, and expand the welfare state—we could tolerate America becoming more like 1970s Scandinavia if it meant that the left would agree let the babies live. But the left won’t, and the Guardian article shows why. Bearing and raising children requires sacrifices even in the most generous of welfare states. Rather than make those sacrifices, this mother sacrificed her child, and the left will defend her absolute right to do so even in their socialist utopia. Their vision of liberation from material necessity includes liberation not only from poverty, but also from the consequences of our sexual embodiment. Hence the unwavering socialist support for unrestricted legal abortion. Of course, many people refuse to admit the monstrous reality of the abortion regime that they and their political leaders support. Hence the pretense that some invisible hand of socialist plenty will end abortion, and the efforts to deflect blame for our nation’s abortion culture onto those who are working to abolish it. But it is just not so. It was not stingy family leave policies that had this baby killed, it was the child’s mother, encouraged and enabled by a culture and legal regime that regard babies as a capstone consumer commodity to be ordered up when convenient, and violently disposed of when inconvenient. She didn’t get an abortion because it was impossible for her to afford her baby; she got an abortion because she didn’t want her baby.""",
    
    """Republicans should stop fighting amnesty, President Obama said on Thursday, because one day a Hispanic will become president. “Over the long term, this is going to get solved, because at some point there’s going to be a President Rodriguez or there’s going to be a President Chen,” Obama told a Florida International University town hall audience, hosted by Telemundo and MSNBC. “The country is a nation of immigrants, and ultimately it will reflect who we are and its politics are going to reflect who we are,” Obama continued, implying that neither native-born Americans or legal immigrants have moral standing to determine who enters and stays in the country. Hispanic foreigners attending the town hall — Fox News Latino did not say whether they were legal or illegal aliens — told Obama they feared that federal Judge Andrew Hansen’s stay on Obama’s executive order will force them to return to their home countries. (Fox News Latino incorrectly identifies Hansen as a Texas judge.) The five million illegal aliens covered by Obama’s executive order could also cash in on as much as $35,000 in taxpayer handouts. That’s a minimum $175 million cost to American taxpayers for the first year alone, not counting the massive strain the low-income, poorly-educated, gang-prone aliens with high rates of illegitimacy and untreated diseases will place on the country’s medical and social institutions. Obama’s claim that “history” was on his side is arguably false. The massive, historically unprecedented wave of immigrants crashing across the U.S. southern border is a political phenomenon, set in motion by the 1965 Immigration and Nationality Act and accelerated by the Obama administration’s disastrous Deferred Action for Childhood Arrivals (DACA). The explosion of the Hispanic population has long-term job prospect consequences as well: Both legal and illegal aliens will occupy 75 percent of new American jobs in as little as five years. Each year, four million Americans seeking jobs turn 18. In 2012, almost six million Americans graduated from college, saddled with an average $27,000 in student loan debt — $8,000 less than the handouts available for illegals presently in the country. Email Katie at kmchugh@breitbart.com.""",
        """From soccer games to marathons, concerns about coronavirus have led sports organizers to cancel or modify major events across the globe. With more than 80,000 reported cases of the disease, the viral outbreak continues to create uncertainty about future competitions, from track and field and Formula 1 to the ultimate global event, the 2020 Tokyo Olympics.
Last Sunday’s Tokyo Marathon, usually one of the largest in the world, went ahead with just 200 elite athletes and a request from organizers for spectators to stay home. The Hong Kong Marathon, scheduled for Feb. 9, was canceled; and the World Indoor Track and Field Championships, set for March 13-15 in Nanjing, China, have been postponed until next year.
Let our news meet your inbox. The news and stories that matters, delivered weekday mornings. This site is protected by recaptcha.
For professional athletes whose bodies are their businesses, health is a top priority. As the epidemic spreads, more and more athletes are forced to weigh a potential threat against the financial loss of missing a competition.
“You’re going to get a lot of different answers,” said Chris Layne, managing director of Total Sports US, which represents some of the world’s top track and field athletes. “If you have an athlete at the pinnacle of their career, both in earnings and performance, maybe they can afford to miss an event versus someone fighting to get to that point.”
Track and field athletes don’t typically earn the lucrative salaries seen in the NBA, NFL, tennis or international soccer. The biggest shot for these athletes to make money lies in prizes and sponsorship deals. To earn either, you have to participate in events. That makes the impact of a missed event more significant, according to Layne.
“If you do six events and say you earn $500, that $3,000 lets you keep performing,” he said. “Track and field is really a global sport in terms of events so it could snowball with an athlete losing six, seven, eight times to compete and make a name for themselves. You could be taking away a season’s worth of earning potential.”
One of the bigger sponsorship opportunities for track and field athletes lies in the Olympics, which provide nearly unparalleled exposure. But if coronavirus continues to be a threat, the decision about whether to risk competing could be out of athletes’ hands.
Dick Pound, a senior member of the International Olympic Committee, said a decision about whether to proceed with holding the event would need to be made by late May. If the coronavirus isn’t contained by that point, Pound said cancellation could be a possibility.
For now, the IOC isn’t planning to cancel the Games, which have dealt with potential health threats in the recent past. There were concerns about bird flu ahead of the 2018 Pyeongchang Olympics, Zika during the 2016 Rio Olympics, and swine flu before the 2010 Vancouver Olympics.""",
    
    """More in-person voting sites in metro areas. Better information about where polls have been relocated. More public education about how to vote from home and what to do if an absentee ballot doesn’t arrive—or arrives at the last minute. And no last-minute government decisions that confuse voters and undermine voting, such as imposing curfews before the polls close.
These are some of the takeaways from the nine presidential primaries that took place on June 2, the largest day of voting across America since the pandemic broke in mid-March, where most of the states and the District of Columbia responded by shifting to voting with mailed-out ballots rather than voting centered on local polling places as in previous elections.
The approaches taken in these states and districts varied and reflected the trends seen across the United States. Montana and Maryland mailed ballots to voters. Washington, D.C., and four states sent voters applications to get a mail-in ballot. Pennsylvania and Indiana left it up to voters to apply for an absentee ballot, get the ballots on time, and submit it on time to be counted.
The results were a spectrum of well-run to more-problematic elections. Montana, which is used to voting by mail, had higher turnout than its 2018 fall midterm. But many voters who were not used to voting from home, especially in metro areas, did not get ballots as expected. They went to vote in person, but often found traditional polling places closed. They ended up in long lines and sometimes faced hours-long waits, where social distancing could be challenging, and, in the worst case—in Washington—police were telling voters to go home because of a curfew.
These trends, both better and worse, offer lessons and warning signs for the fall’s elections.
“Overall, this is a dry run for November,” said Kristen Clarke, president and executive director of the Lawyers’ Committee for Civil Rights Under Law, which runs the nation’s largest Election Day hotline and fielded more than 5,000 calls for the primaries. “We’re bracing for high turnout that we will see in the November general election, and lessons learned from this primary season must guide states… to ensure that every eligible voter can have their voice heard.”
“It is clear that the pandemic is having an impact on virtually every aspect of the voting experience,” she said, noting that impact was apart from a curfew in Washington that was announced by a text alert on Election Day that “did not have an exception making it clear that voters can, indeed, continue to travel to cast their ballot.”
Voting in quasi-militarized settings was not confined to the nation’s capital. In Philadelphia, on election eve, the mayor announced a curfew that was slated to take effect an hour before its polls closed, but subsequently delayed it after an outcry by other city officials and activists. The curfews, which have never before occurred on an Election Day in recent times, were a response to looting that occurred after generally peaceful protests against police violence and racism. However, the curfews also come in a climate where the Republican Party, led by President Trump, has been repeatedly making false claims that voting by mail is rife with fraud.
“This is simply not true,” wrote the National Vote at Home Institute’s Amber McReynolds and MIT’s Charles Stewart III, both experts, for the Hill. They noted that the right-wing Heritage Foundation’s oft-cited election fraud database listed 204 cases and 143 convictions using mailed ballots in the past 20 years, where “about 250 million votes have been cast by a mail ballot.” That activity level is “about five times less likely than getting hit by lightning in the United States.”
But while partisan propaganda about voting by mail is only likely to increase as the general election nears, the nuts-and-bolts challenges of shifting to voting by mail in states that have not widely instituted that process is very much a work in progress. In that sense, the statewide and district primaries on June 2, as well as dozens of elections that will be held now through the summer, are microcosms of what is working and what needs to be fixed for the fall.
A Spectrum of States
The June 2 primaries featured jurisdictions with more and less experience running mail-based elections. On the most experienced side, Montana, where the senior statewide election official is a Republican, continued its practice of mailing all voters a ballot. More people voted for its 2020 primary than during the state’s November 2018 midterms.
“Sixty-three percent of active registered voters,” said Phil Keisling, the National Vote at Home Institute’s board chair and former Oregon secretary of state. “That’s higher than 41 states in their midterms in 2018. That’s the power of mailing everyone a ballot.”
While Montana was an example of how voter turnout will increase in states where voters have become used to voting from home, the experience in Midwestern and Eastern states that have not embraced voting from home until the pandemic was rockier was a different story—and not just because of the pandemic’s social distancing requirements or police presence due to widespread protests.
In Pennsylvania’s largest cities, Philadelphia and Pittsburgh, in Washington, D.C., in Baltimore, Maryland, and in Indianapolis, Indiana, election officials underestimated the number of people who sought to vote in person for any number of reasons: from not getting a mail-in ballot; to getting a ballot late and wanting to drop it off; to simply wanting to vote in a polling place.
While Pennsylvania’s top officials reported a “smooth election amid historic circumstances” as 1.8 million residents applied for an absentee ballot, “17 times greater than the number who applied” in its 2016 presidential primary, voting rights advocates manning election-protection hotlines observed a different experience. The Lawyers’ Committee said that 55 percent of the calls received on June 2 were from Pennsylvania—and from people unable to vote by mail.
Half of the hotline calls concerned finding a polling place, the Committee’s Lacy Crawford said. Another 17 percent concerned ballots—meaning unfamiliarity with mailed-out ballots versus polling place voting. Another 13 percent concerned voter registration. Of slightly less than half of the callers who reported their race, 63 percent were Black, 21 percent were white and 12 percent were Latino.
The takeaway from the committee briefings, where its partners summarized what they were hearing from hundreds of observers, underscored that accommodating the fall’s voters will mean planning for high levels of voting from home—but still significant in-person voting at precincts. That conclusion is what emerges after hearing detailed reports of snafus.
“The big theme of the day is confusion,” said Ivan Garcia, civic engagement director for MakeTheRoadPA.org. “Voters are turning up to their old polling place and not always finding directions to the consolidated poll place that they should be going to. Because of the pandemic, you had last-minute changes, and it confused a lot of voters.”"""
]
sample_dataset = tf.data.Dataset.from_tensor_slices(articles)
text_vectorization.adapt(sample_dataset)

# Recreate the model architecture
def create_multi_output_model(vocab_size, embed_dim=128, num_bias_classes=3, num_opinion_classes=4, num_type_classes=3):
    text_input = keras.layers.Input(shape=(1,), dtype=tf.string)
    vectorized = text_vectorization(text_input)
    embedded = keras.layers.Embedding(vocab_size, embed_dim, mask_zero=True)(vectorized)
    x = keras.layers.Bidirectional(keras.layers.LSTM(64, return_sequences=True))(embedded)
    x = keras.layers.Bidirectional(keras.layers.LSTM(32))(x)
    x = keras.layers.Dense(64, activation="relu")(x)
    x = keras.layers.Dropout(0.5)(x)

    bias_output = keras.layers.Dense(num_bias_classes, activation='softmax', name='bias_output')(x)
    opinion_output = keras.layers.Dense(num_opinion_classes, activation='softmax', name='opinion_output')(x)
    type_output = keras.layers.Dense(num_type_classes, activation='softmax', name='type_output')(x)

    model = keras.Model(text_input, [bias_output, opinion_output, type_output])
    return model

# Create the model
vocab_size = max_tokens + 1  # +1 for the OOV token
model = create_multi_output_model(vocab_size)

# Compile the model
optimizer = keras.optimizers.Adam(learning_rate=0.001)
model.compile(
    optimizer=optimizer,
    loss={
        'bias_output': 'sparse_categorical_crossentropy',
        'opinion_output': 'sparse_categorical_crossentropy',
        'type_output': 'sparse_categorical_crossentropy'
    },
    metrics={
        'bias_output': 'accuracy',
        'opinion_output': 'accuracy',
        'type_output': 'accuracy'
    }
)

# Load weights
try:
    model.load_weights('bias_detection.keras')
    print("Weights loaded successfully.")
except Exception as e:
    print(f"Error loading weights: {e}")

# Test the model with a sample input
sample_text = ["It seems almost inane to remark on an electoral horse race at such a historic time. Why should we care about Donald Trump’s electoral chances when energized citizens across America are braving injury and arrest to confront white supremacy and police violence? But it’s important nonetheless. That’s because while these problems have been centuries in the making from slavery to Jim Crow to Ferguson and beyond, Donald Trump’s particular failings as a person and a candidate are fanning the flames of the crisis. Rather than help be a part of the solution, he is intentionally exacerbating the tensions–not only because he himself is a racist whose politics of authoritarian white grievance align with the same forces driving police violence itself, but because he is desperate and in grave political peril. This isn’t news: he has been for some time. He has consistently trailed all the leading Democratic contenders in national polling since the beginning of the primary campaign—not just nationally, but also in the swing states he needs in the electoral college. If he loses in November he and his defenders will claim he was on a pathway to victory before external forces derailed him, but this would be wrong. Even when the economy was strong, which normally bodes very well for first-term presidents’ odds at winning another four years, much of the persuadable public simply found itself so exhausted by Trump’s ongoing campaign against public decency that they were ready to vote for an alternative who did not take active measures to offend people on a daily basis. Matters worsened for him when COVID-19 hit the United States and exposed him not just as a divisive buffoon, but a cynically incompetent one. The Administration delayed its response, worried that any action they took would hurt the stock market and erode Trump’s last remaining electoral strength. But even as the job losses mounted into the tens of millions as the nation rushed to try to contain an already widespread pandemic, the President personally promoted miracle quack cures like hydroxychloroquine and demonstrated his unbridled personal buffoonery by wondering aloud about the possibility of drinking bleach and injecting sunlight as a method of curing oneself of coronavirus. Even before the brutal killing of George Floyd by officers of the Minneapolis Police Department, Trump knew that he would need to maximize his culture war appeal to non-college whites to make up ground lost to the faltering economy. There can be little doubt that Trump saw opportunity in the protests that followed to dust off the Nixon playbook, vowing to restore “law and order” in a country furious that the law seemed to protect only some, while enforcing a brutal order on others. If Trump’s actions threatened to turn the culture war into an active shooting war, that would just be collateral damage on the road to his political recovery. The Trump orbit considers the iconography of jingoistic militarism and the violent suppression of protest to be a political winner. Consider, for instance, Rudy Giuliani’s bizarre 9/11 tribute tweet promoting a video that featured riot police, the military, and high school football squaring off against young protesters replete with counterculture stereotypes, including flag-burners, anti-police sentiment and even men with long hair (how dare they.) Trump, like Nixon before him, uses “law and order” as a way of “talking about race without talking about race.” In this narrative, a president who supports American “traditional culture” and stands strong against people who agitate for racial justice will win over a “silent majority” of people who just don’t want to be disturbed and want to have some peace and quiet from their politics. In this context, the killing of George Floyd was not a crisis, but an opportunity. A president with an ounce of self-respect, dignity and compassion would have done her best to understand the anguish and grief facing the black community as yet another black person was killed needlessly and with zero remorse by a police force accustomed to no accountability. A president who made a semblance of caring about the country as a whole would have made at least a show of sympathy. Trump could not do even this. This is, first and foremost, because Trump is the same man who published a full-page ad recommending the execution of the innocent Central Park 5, and has refused to apologize for or even retract his position. He is the same man who, as president, implemented a policy of separating immigrant children from their parents to lock them in cages without blankets or toothpaste, as an explicit deterrent to other potential (nonwhite, of course) immigrants seeking a better life. As Adam Serwer unforgettably said, the cruelty is the point. Trump enjoys and encourages state brutality against people of color, and black people in particular. It excites him and his most ardent followers. But his response isn’t just based on personal predilections. It’s also based on political considerations. Trump sees shades of a 1968-style law-and-order culture campaign that can carry him to re-election when literally nothing else can. Any normal president would have made an Oval Office address to the nation as soon as major protests began. Trump, despite his braggadoccio, showed characteristic cowardice and indecision for days, choosing to post inflammatory tweets while hiding in a White House bunker. When he finally did make a public address, it was little more the chest-puffing false bravado of a petty tyrant. He has encouraged governors to use extreme force against protesters, using “antifa” and a small minority of looters and criminals as an excuse. In a tweet that was flagged with a warning by Twitter for its glorifcation of violence, he used a phrase that harkened back to the segregation era to threaten lethal force against protests. He has repeatedly threatened to use the military to suppress dissent. He has rebuffed the calls of Mayor Muriel Bowser of the District of Columbia to demilitarize the response to the protests, and has vowed to replace the troops she refuses with forces beyond her control. He has turned the District of Columbia, a plurality black city, into a militarized zone with non-uniformed secret police, and the White House as a closed-off fortress in its center. Across the country, police have intentionally targeted journalists, leaving many with disfiguring injuries. Can there be any doubt that this unprecedented violence against the press was spurred on by Trump’s endless war with any media that holds him accountable? Given that Trump received the support of 84 percent of America’s police officers, how could it be otherwise? And most egregiously, in what will surely be viewed as one of the most ill-advised stunts in presidential history, the Trump Administration had federal security forces use tear gas and projectiles to vacate Lafayette square by force of arms so Trump could make a show of walking over to St. John’s Church and posing awkwardly with a bible held upside down. The message that Trump wanted to send with this stunt is not hard to decipher. It cast him as the warrior of white evangelical Christianity, waging a holy crusade by force of arms against those who would oppose it as the dominant force in American electoral politics. Trump will fail, however, because neither the bastions of white culture nor the nation’s security apparatus are on his side this time. No matter what Trump did previously, the elements that represented these conservative institutional bastions would not condemn him. But Trump’s effort to use the military as both a political and kinetic weapon against Americans exercising their constitutional rights has caused the people who should be his allies to turn against him. It earned him stinging, humiliating rebukes from respected military leaders such as four-star Marine Corps General and former Secretary of Defense James Mattis. Conservative columnist George Will has called for the removal of Trump and the Congressional leaders who enable him. This despicable act even earned him condemnation from televangelist Pat Robertson, one his bedrock supporters in the white Christian evangelical movement. Meanwhile, people of all races across America have watched in horror as police continue to commit violent acts of brutality against the people who are legally and peacefully protesting police brutality. Statistically speaking, white people have historically not believed that institutional racism in the police force is an issue worth their attention. Now, for the first time, a majority of whites do, and Americans of all races are overwhelmingly supportive of the protests against the killing of George Floyd. If Trump was planning on dividing Americans by race and cleaving more whites to his side, the plan is backfiring. Trump even seems to have a reverse Midas touch in recent polling on these issues: while Americans were broadly supportive of using the military to quell the civil disturbances at first, Trump’s embrace of the tactic seems to have helped drive those numbers into negative territory in just a few days. In one sense, he’s right: people are exhausted with chaos, and they do want a respect for law and order. The problem for Trump? The chaos is in large part of his own making, and insofar as it isn’t, he’s in the way of solving the problems created by institutional racism and overlapping hierarchies of oppression. The massive wave of police brutality has woken even many previously disengaged white people up to the need for true equality under the law, and an order in which everyone, including police and the president, are held to account. And many of the same people Trump is trying to persuade now believe that kicking him out of the White House is a necessary prerequisite for making that vision a reality."]
sample_tensor = tf.constant(sample_text)

try:
    predictions = model.predict(sample_tensor)
    print("Model prediction shapes:")
    for i, pred in enumerate(predictions):
        print(f"Output {i+1} shape: {pred.shape}")
except Exception as e:
    print(f"Error during prediction: {e}")
import numpy as np

# Assuming predictions are the output of the model
bias_predictions = predictions[0]
opinion_predictions = predictions[1]
type_predictions = predictions[2]

# Get the predicted class indices
predicted_bias_class = np.argmax(bias_predictions, axis=-1)  # Get index of max probability for bias
predicted_opinion_class = np.argmax(opinion_predictions, axis=-1)  # Get index of max probability for opinion
predicted_type_class = np.argmax(type_predictions, axis=-1)  # Get index of max probability for type

print(f"Predicted Bias Class: {predicted_bias_class}")
print(f"Predicted Opinion Class: {predicted_opinion_class}")
print(f"Predicted Type Class: {predicted_type_class}")
